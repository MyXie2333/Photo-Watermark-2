# Photo Watermark 2 - Windows图形化水印软件

## 简介
Photo Watermark 2 是一款专为Windows系统设计的图形化图片水印添加工具。它提供了直观易用的界面，让您能够轻松地为图片添加文本水印和图片水印，支持实时预览、多种字体样式、位置调整和特效渲染等功能，同时支持单张和批量处理。

## 主要功能

### 图片管理
- **多种导入方式**: 支持单张图片导入、文件夹批量导入和拖拽导入
- **格式支持**: 兼容JPG、PNG、BMP、TIFF等常见图片格式
- **智能检测**: 自动识别并跳过重复图片文件
- **缩略图预览**: 左侧缩略图列表清晰展示所有导入的图片
- **图片信息显示**: 实时显示原图尺寸、压缩尺寸、压缩比例和预览缩放比例

### 文本水印功能
- **文本设置**: 支持自定义水印文本内容
- **字体控制**: 
  - 支持系统已安装字体选择
  - 字号调节（8px-200px）
  - 粗体/斜体样式切换（包括手动实现效果）
  - 中文字体智能选择和加载
- **颜色和透明度**: 
  - 完整的颜色选择器
  - 0-100%透明度滑块调节
- **特效支持**:
  - 阴影效果（颜色、偏移量、模糊度）
  - 描边效果（颜色、宽度、偏移量）
- **旋转功能**: 支持-180°到180°的旋转角度调节

### 图片水印功能
- **图片导入**: 支持选择本地图片作为水印
- **格式支持**: 支持带透明通道的PNG图片
- **缩放控制**: 支持按比例缩放和精确尺寸调节
- **透明度调节**: 0-100%透明度滑块
- **位置调整**: 支持九宫格定位和手动拖拽调整

### 图片预览与浏览
- **高清预览**: 中央预览区域显示当前选中图片
- **缩放控制**: 支持放大、缩小、适应窗口等多种缩放模式
- **便捷切换**: 支持上一张/下一张图片快速切换
- **自动适应**: 预览区域默认适应窗口大小显示
- **坐标显示**: 实时显示鼠标坐标和水印坐标
- **水印警告**: 当水印可能超出图片边界时显示警告提示

### 导出功能
- **单张导出**: 支持导出当前预览的图片
- **批量导出**: 支持一次性导出所有导入的图片
- **格式选择**: 支持JPG和PNG格式导出
- **质量控制**: JPG格式支持0-100%质量调节
- **命名规则**: 支持自定义前缀和后缀

### 模板管理
- **模板保存**: 将当前水印设置保存为模板
- **模板加载**: 快速应用已保存的水印模板
- **分类管理**: 支持文本模板和图片模板分类
- **默认模板**: 程序启动时自动加载上一次的设置

### 用户界面
- **现代化设计**: 简洁直观的三栏布局界面（左侧图片列表、中央预览、右侧设置）
- **快捷键支持**: 常用操作支持快捷键（Ctrl+O导入图片，Ctrl+0适应窗口等）
- **状态提示**: 实时显示当前操作状态和图片信息
- **拖拽交互**: 支持拖拽图片文件导入和拖拽调整水印位置

### 性能优化
- **渲染缓存机制**: 水印渲染结果缓存，避免重复计算
- **字体路径缓存**: 优化字体加载性能
- **智能压缩**: 大图片自动压缩以提高预览性能
- **实时预览优化**: 水印设置变化时高效更新预览

## 技术架构

### 核心模块
- **主程序** (`src/main.py`): 应用程序入口和初始化
- **图片管理器** (`src/image_manager.py`): 图片导入、存储和管理功能
- **水印渲染器** (`src/watermark_renderer.py`): 水印渲染引擎，支持文本特效和缓存机制
- **配置管理器** (`src/config_manager.py`): 应用程序配置的持久化存储
- **水印拖拽管理器** (`src/watermark_drag_manager.py`): 处理水印拖拽交互逻辑

### UI组件
- **主窗口** (`src/ui/main_window.py`): 三栏布局主界面，包含预览区域和交互控制
- **图片列表组件** (`src/ui/image_list_widget.py`): 图片缩略图列表显示和管理
- **文本水印组件** (`src/ui/text_watermark_widget.py`): 文本水印设置和控制面板
- **图片水印组件** (`src/ui/image_watermark_widget.py`): 图片水印设置和控制面板
- **导出对话框** (`src/ui/export_dialog.py`): 导出选项设置对话框
- **模板管理对话框** (`src/ui/template_manager_dialog.py`): 水印模板管理对话框

## 快速开始

### 系统要求
- Windows 7/8/10/11 操作系统
- Python 3.8 或更高版本

### 安装步骤

1. **下载项目**
   ```bash
   git clone <项目地址>
   cd photo-watermark2
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **启动应用**
   ```bash
   python src/main.py
   ```
   或使用快捷启动
   ```bash
   python run_app.py
   ```

### 使用方法

1. **导入图片**
   - 点击菜单"文件"→"导入图片"或使用快捷键 Ctrl+O
   - 选择要添加水印的图片文件
   - 或直接将图片文件拖拽到应用窗口

2. **批量导入**
   - 点击菜单"文件"→"导入文件夹"
   - 选择包含图片的文件夹，系统会自动导入所有支持的图片格式

3. **浏览图片**
   - 在左侧缩略图列表中点击图片进行预览
   - 使用工具栏的"上一张"、"下一张"按钮或键盘方向键切换图片

4. **添加文本水印**
   - 在右侧面板输入水印文本
   - 选择字体、大小、样式（粗体/斜体）
   - 调整颜色和透明度
   - 设置位置（九宫格定位或手动拖拽）
   - 添加特效（阴影、描边）
   - 调整旋转角度

5. **添加图片水印**
   - 切换到图片水印标签页
   - 点击"选择图片"按钮导入水印图片
   - 调整水印大小、透明度和位置
   - 设置旋转角度

6. **缩放控制**
   - 使用工具栏的放大、缩小、适应窗口按钮调整预览大小
   - 适应窗口功能会自动调整图片大小以最佳方式显示

7. **使用模板**
   - 点击"模板"按钮打开模板管理对话框
   - 选择已保存的模板应用到当前图片
   - 或保存当前设置为新模板

8. **导出图片**
   - 点击"导出"按钮打开导出对话框
   - 选择导出路径、格式和命名规则
   - 点击"导出"按钮完成导出
   - 批量导出时可选择所有图片或仅当前图片

## 项目结构
```
photo-watermark2/
├── src/                    # 源代码目录
│   ├── main.py             # 主程序入口
│   ├── config_manager.py   # 配置管理模块
│   ├── image_manager.py    # 图片管理模块
│   ├── watermark_drag_manager.py # 水印拖拽管理器
│   ├── watermark_renderer.py # 水印渲染引擎
│   ├── ui/                 # 界面模块
│   │   ├── __init__.py
│   │   ├── export_dialog.py # 导出对话框
│   │   ├── image_list_widget.py # 图片列表组件
│   │   ├── image_watermark_widget.py # 图片水印组件
│   │   ├── main_window.py      # 主窗口
│   │   ├── template_manager_dialog.py # 模板管理对话框
│   │   └── text_watermark_widget.py # 文本水印组件
│   └── utils/              # 工具函数目录
├── template/               # 水印模板存储目录
│   ├── image/              # 图片水印模板
│   └── text/               # 文本水印模板
├── docs/                   # 开发文档
│   ├── PRD.md              # 产品需求文档
│   └── 开发计划.md         # 开发工作计划
├── test_photos/            # 测试图片
├── exports/                # 导出图片示例
├── requirements.txt        # 依赖包列表
├── run_app.py              # 快捷启动脚本
├── PhotoWatermark2.spec    # PyInstaller打包配置
├── photo_watermark.spec    # PyInstaller打包配置
├── README.md               # 项目说明文档
└── TODO.md                 # 待办事项
```

## 技术特点
- **Windows专用**: 专为Windows系统优化的图像处理和用户体验
- **高性能处理**: 优化的图像处理算法和缓存机制，确保处理效率
- **用户友好**: 直观的图形界面设计，降低使用门槛
- **模块化架构**: 清晰的模块划分，便于维护和扩展
- **智能字体处理**: 支持中文字体智能选择和手动实现字体效果
- **实时预览**: 高效的实时预览机制，提供即时反馈
- **可执行文件**: 支持打包为单文件可执行程序，无需安装依赖
- **模板系统**: 强大的水印模板管理功能，支持保存和复用水印设置

## 开发状态
当前项目已完成全部核心功能开发，包括：
- ✅ 基础UI框架搭建
- ✅ 图片导入和管理功能
- ✅ 文本水印完整功能（文本、字体、颜色、透明度、特效、旋转）
- ✅ 图片水印功能
- ✅ 实时预览和布局控制
- ✅ 单张和批量导出功能
- ✅ 完整模板管理功能
- ✅ 图片缩放和适应窗口功能
- ✅ 水印拖拽调整功能
- ✅ PyInstaller打包支持
- ✅ UI优化和bug修复
- ✅ 模板管理增强
- ✅ 性能优化

## 已解决的问题
所有已知问题已在最终开发阶段解决：
- ✓ 批量导出闪退问题已修复
- ✓ 大图片处理性能问题已优化
- ✓ 模板搜索功能已实现
- ✓ 高级导出选项功能已完善

## 未来版本计划功能
- 水印平铺功能
- 多种水印组合功能
- 更多水印特效支持
- 图片批处理任务调度
- 主题切换功能

## 打包与分发
项目支持使用PyInstaller打包为单文件可执行程序，具体步骤：

1. 确保已安装PyInstaller
   ```bash
   pip install pyinstaller
   ```

2. 使用提供的spec文件打包
   ```bash
   python -m PyInstaller --onefile --windowed --name PhotoWatermark2 "--add-data=template;template" --hidden-import PyQt5.QtCore --hidden-import PyQt5.QtGui --hidden-import PyQt5.QtWidgets --hidden-import PIL --hidden-import numpy --hidden-import cv2 src/main.py
   ```

3. 打包完成后，可执行文件位于`dist`目录下

## 支持与反馈
如果您在使用过程中遇到任何问题或有改进建议，欢迎通过以下方式联系我们：
- 提交Issue到项目仓库
- 发送邮件至开发团队

## 许可证
本项目采用MIT开源许可证，详情请查看LICENSE文件。
